<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kong-util</title>
    <script src="./dist/all.js"></script>
    <script>
        kongUtil.wait(100).then(kongUtil.logger("Traditional mode works on assignment of a global `kongUtil` variable."));
        kongUtil.use();
        wait(200).then(logger("After calling `use()` in traditional mode, you can use corresponding methods anywhere, even in module mode."));
    </script>
    <script type="module">
        import ku from "./mod/async.mjs";
        import {logger as aa} from "./mod/debug.mjs";
        ku.wait(300).then(aa("Module mode works on importing from a ES module file."));
        ku.use();
    </script>
    <script type="module">
        wait(400).then(logger("After calling `use()` of the imported object, you can use methods (but not kongUtil itself) even in another <script type\"module\">, but not without module mode."));
    </script>
</head>
<body>
    <h1>kong-util demo</h1>
    Try clicking these buttons:
    <ol>
        <li><button>listen for clicking</button></li>
        <li><button>listen for clicking but alerts with a delay</button></li>
        <li><button>waitFor() only for once</button></li>
        <li><button>click this and the next one in one second</button></li>
        <li><button>click the above one before clicking me</button></li>
    </ol>
    <footer>
        <a href="https://github.com/kong0107/kong-util/blob/gh-pages/demo.html">source code of this page</a>
    </footer>
    <script>
        const buttons = $$("button");
        // an alias of `document.querySelectorAll()`

        listen(buttons[0], "click", alerter("You've clicked the first button"));
        // a shortcut to `EventTarget.addEventListener()`
        // `alerter()` returns a function

        listen(buttons[1], "click", async () => {
            await wait(500); // how simple!
            alert("You've clicked the second button half a second ago.");
        });

        waitFor(buttons[2], "click")
        .then(alerter("You've clicked the third button for the first time.\nThis message would not be shown again without refreshing the page."));
        // a promise is pending for an event; this triggers only once.

        listen(buttons[3], "click", () => {
            waitFor(buttons[4], "click", 1000)
            .then(alerter("success!"))
            .catch(alerter("failed to click the specified button in one second."));
        });
        // combination of a listener and a promise.

        Promise.all(
            buttons.map(btn => waitFor(btn, "click"))
        )
        .then(() => $("body").append(parseHTML("<p>All buttons are <mark>clicked</mark> at least once.</P>")));
        // promises waiting for their respective events
        // HTML strings may be parsed into DOM object with one function
    </script>
</body>
</html>
